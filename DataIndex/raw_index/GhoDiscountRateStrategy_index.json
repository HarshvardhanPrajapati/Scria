[
    {
        "id": "GhoDiscountRateStrategy_contract_context",
        "chunk_type": "CONTRACT_CONTEXT",
        "source_contract": "GhoDiscountRateStrategy.sol",
        "target_function": "ALL",
        "text_chunk": "// SPDX-License-Identifier: MIT\npragma solidity ^0.8.10;\n\nimport {WadRayMath} from '@aave/core-v3/contracts/protocol/libraries/math/WadRayMath.sol';\nimport {IGhoDiscountRateStrategy} from './interfaces/IGhoDiscountRateStrategy.sol';\n\n/**\n * @title GhoDiscountRateStrategy contract\n * @author Aave\n * @notice Implements the calculation of the discount rate depending on the current strategy\n */\ncontract GhoDiscountRateStrategy is IGhoDiscountRateStrategy {\n  using WadRayMath for uint256;\n\n  /**\n   * @dev Amount of debt that is entitled to get a discount per unit of discount token\n   * Expressed with the number of decimals of the discounted token\n   */\n  uint256 public constant GHO_DISCOUNTED_PER_DISCOUNT_TOKEN = 100e18;\n\n  /**\n   * @dev Percentage of discount to apply to the part of the debt that is entitled to get a discount\n   * Expressed in bps, a value of 2000 results in 20.00%\n   */\n  uint256 public constant DISCOUNT_RATE = 0.3e4;\n\n  /**\n   * @dev Minimum balance amount of discount token to be entitled to a discount\n   * Expressed with the number of decimals of the discount token\n   */\n  uint256 public constant MIN_DISCOUNT_TOKEN_BALANCE = 1e15;\n\n  /**\n   * @dev Minimum balance amount of debt token to be entitled to a discount\n   * Expressed with the number of decimals of the debt token\n   */\n  uint256 public constant MIN_DEBT_TOKEN_BALANCE = 1e18;\n\n  /// @inheritdoc IGhoDiscountRateStrategy\n  function calculateDiscountRate(\n    uint256 debtBalance,\n    uint256 discountTokenBalance\n  ) external pure override returns (uint256) {\n    if (discountTokenBalance < MIN_DISCOUNT_TOKEN_BALANCE || debtBalance < MIN_DEBT_TOKEN_BALANCE) {\n      return 0;\n    } else {\n      uint256 discountedBalance = discountTokenBalance.wadMul(GHO_DISCOUNTED_PER_DISCOUNT_TOKEN);\n      if (discountedBalance >= debtBalance) {\n        return DISCOUNT_RATE;\n      } else {\n        return (discountedBalance * DISCOUNT_RATE) / debtBalance;\n      }\n    }\n  }\n}\n",
        "formal_property": null,
        "nl_summary": "",
        "metadata": {
            "function_list": [
                "calculateDiscountRate"
            ],
            "state_variables": [],
            "is_standard": "UNKNOWN"
        }
    },
    {
        "id": "GhoDiscountRateStrategy_limitOnDiscountRate_5c5ed460",
        "chunk_type": "FUNCTION_RULE",
        "source_contract": "GhoDiscountRateStrategy.sol",
        "target_function": "calculateDiscountRate",
        "text_chunk": "  function calculateDiscountRate(\n    uint256 debtBalance,\n    uint256 discountTokenBalance\n  ) external pure override returns (uint256) {\n    if (discountTokenBalance < MIN_DISCOUNT_TOKEN_BALANCE || debtBalance < MIN_DEBT_TOKEN_BALANCE) {\n      return 0;\n    } else {\n      uint256 discountedBalance = discountTokenBalance.wadMul(GHO_DISCOUNTED_PER_DISCOUNT_TOKEN);\n      if (discountedBalance >= debtBalance) {\n        return DISCOUNT_RATE;\n      } else {\n        return (discountedBalance * DISCOUNT_RATE) / debtBalance;\n      }\n    }\n  }\n",
        "formal_property": "rule limitOnDiscountRate() {\n    uint256 debtBalance;\n    uint256 discountTokenBalance;\n    uint256 discountRate = calculateDiscountRate(debtBalance, discountTokenBalance);\n    assert(discountRate <= DISCOUNT_RATE());\n}\n",
        "nl_summary": "",
        "metadata": {
            "rule_name": "limitOnDiscountRate",
            "rule_type": "rule",
            "modifies_state": true,
            "methods_in_block": [
                "calculateDiscountRate",
                "DISCOUNT_RATE"
            ],
            "start_line": 14,
            "end_line": 19,
            "block_hash": "5c5ed46070393d13473073e85245618a"
        }
    }
]